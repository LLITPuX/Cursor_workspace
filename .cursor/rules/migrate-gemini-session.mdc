---
description: Правила міграції сесій Gemini через docs-scraper-service API
globs: **/*.md, **/*.py
---

# Міграція сесій Gemini

Цей інструмент дозволяє зберегти публічну сесію Gemini (Gem-bot) у локальний файл для подальшого використання як контексту архітектурних рішень.

## Контекст та призначення

**Різниця між типами сесій:**
- **gemini_session_*.md** - це сесії Архітектора (Gem-bot), зберігаються в `saved_sessions/Gemini_chat/`. Це "Long-term Memory" Архітектора з стратегічними рішеннями та архітектурними обговореннями.
- **session_*.md** - це мої звіти (Field Reports), зберігаються в `saved_sessions/`. Це детальні звіти про технічну реалізацію.

**Призначення міграції:**
- Зберегти стратегічні рішення Архітектора для подальшого використання
- Створити контекст для розуміння архітектурних рішень
- Після міграції можна використати `/db` для інгестії в граф знань

## Коли використовувати

Використовуй цей інструмент коли:

1. **Користувач надає публічний URL сесії Gemini** (share link від Gem-bot)
2. **Користувач просить зберегти/мігрувати сесію** з Gem-bot
3. **Потрібно зберегти стратегічне рішення** Архітектора для подальшого використання
4. **Користувач явно просить використати інструмент** міграції сесій

## Як використовувати

### Крок 1: Перевірка сервісу

Переконайся що `docs-scraper-service` запущений:

```bash
docker ps | findstr docs-scraper-service
# або
docker-compose -f "c:\Cursor workspace\docs-scraper-service\docker-compose.yml" ps
```

Якщо сервіс не запущений, запусти його:

```bash
cd "c:\Cursor workspace\docs-scraper-service"
docker-compose up -d --build
```

### Крок 2: Виконання запиту

Виконай POST запит до API з URL сесії Gemini.

**PowerShell:**
```powershell
$body = @{
    url = "GEMINI_SHARE_URL"
} | ConvertTo-Json

$response = Invoke-RestMethod -Uri "http://localhost:8002/api/v1/scraper/gemini" -Method Post -Body $body -ContentType "application/json"
Write-Host "File saved to: $($response.file_path)"
Write-Host "Messages count: $($response.items_count)"
```

**Bash/CMD:**
```bash
curl -X POST "http://localhost:8002/api/v1/scraper/gemini" \
  -H "Content-Type: application/json" \
  -d "{\"url\": \"GEMINI_SHARE_URL\"}"
```

### Крок 3: Перевірка результату

Після успішного запиту перевір:
- Шлях до збереженого файлу (відповідь містить `file_path`)
- Кількість повідомлень (`items_count`)
- Файл має бути в `saved_sessions/Gemini_chat/`

### Крок 4: Повідомлення користувача

Повідом користувача про успішне збереження:
- Шлях до файлу
- Кількість повідомлень
- Можливість використати `/db` для інгестії в граф

## Технічні деталі

**API Endpoint:**
- URL: `POST http://localhost:8002/api/v1/scraper/gemini`
- Content-Type: `application/json`

**Request Body:**
```json
{
  "url": "GEMINI_SHARE_URL",
  "filename": "optional_custom_filename.md"
}
```

**Response:**
```json
{
  "success": true,
  "message": "Session saved successfully",
  "file_path": "/app/saved_sessions/Gemini_chat/session_2026-01-29_18-06-55_building_base_graph_architecture.md",
  "items_count": 23
}
```

**Формат імені файлу:**
- `session_YYYY-MM-DD_HH-MM-SS_english_topic.md`
- Дата та час: точний timestamp для хронологиї
- Тема: англійська транслитерація з кирилиці (snake_case)
- Приклад: `session_2026-01-29_18-06-55_building_base_graph_architecture.md`

**Місце збереження:**
- Локальний шлях: `c:\Cursor workspace\saved_sessions\Gemini_chat\`
- Шлях в контейнері: `/app/saved_sessions/Gemini_chat/`

## Важливі зауваження

1. **Це не мої сесії** - файли `gemini_session_*.md` або `session_*.md` в `Gemini_chat/` - це сесії Архітектора, не мої Field Reports.

2. **Автоматична очистка** - інструмент автоматично:
   - Видаляє UI-артефакти ("Export to Sheets")
   - Екранує HTML-теги (`<script>`, `<style>` тощо) для сумісності з Markdown парсерами
   - Видаляє таблиці з табуляцією (невалідний Markdown синтаксис)
   - Очищає навігаційні елементи

3. **Після міграції** - можна використати команду `/db` для інгестії файлу в граф знань:
   ```bash
   /db saved_sessions/Gemini_chat/session_2026-01-29_18-06-55_building_base_graph_architecture.md
   ```

4. **Формат файлу** - файл зберігається у форматі Markdown з:
   - Заголовком сесії
   - Датою та часом
   - Тематикою
   - Запитами користувача та відповідями моделі

5. **Хронология** - точний час у форматі `HH-MM-SS` дозволяє відстежувати кілька сесій в день.

## Приклади використання

### Приклад 1: Міграція сесії з URL

Користувач: "Збережи цю сесію: https://gemini.google.com/share/abc123..."

Ти виконуєш:
```powershell
$body = @{
    url = "https://gemini.google.com/share/abc123..."
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8002/api/v1/scraper/gemini" -Method Post -Body $body -ContentType "application/json"
```

Результат: Файл збережено в `saved_sessions/Gemini_chat/session_2026-01-29_18-06-55_...md`

### Приклад 2: Міграція з кастомним ім'ям файлу

```powershell
$body = @{
    url = "GEMINI_SHARE_URL"
    filename = "custom_session_name.md"
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8002/api/v1/scraper/gemini" -Method Post -Body $body -ContentType "application/json"
```

### Приклад 3: Перевірка статусу сервісу

Перед виконанням запиту перевір чи сервіс доступний:

```bash
curl http://localhost:8002/api/v1/scraper/health
```

Очікувана відповідь: `{"status": "healthy", "service": "docs-scraper"}`

## Обробка помилок

Якщо сервіс не відповідає:
1. Перевір чи запущений контейнер: `docker ps`
2. Перевір логи: `docker logs docs-scraper-service`
3. Перезапусти сервіс: `docker-compose restart` в директорії `docs-scraper-service`

Якщо запит повертає помилку:
1. Перевір чи URL валідний та публічний
2. Перевір формат JSON запиту
3. Перевір логи сервісу для деталей помилки
