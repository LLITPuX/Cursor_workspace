# üß† –°–∏—Å—Ç–µ–º–∞ –ü–∞–º'—è—Ç—ñ Neon (Bootstrap Protocol)

## üéØ –û—Å–Ω–æ–≤–Ω–∞ —ñ–¥–µ—è
–¢–≤–æ—ó –¥–µ—Ç–∞–ª—å–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö Neon. –¶–µ –ø—Ä–∞–≤–∏–ª–æ ‚Äî –ª–∏—à–µ "–±—É—Ç—Å—Ç—Ä–∞–ø" –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –Ω–∏—Ö.

## üîÑ –û–±–æ–≤'—è–∑–∫–æ–≤–∏–π —Ü–∏–∫–ª –¥–ª—è –ö–û–ñ–ù–û–ì–û –∑–∞–ø–∏—Ç—É

### –ö—Ä–æ–∫ 1: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –ø—Ä–∞–≤–∏–ª (MANDATORY - –∑–∞–≤–∂–¥–∏)
–ü—Ä–∏ –ø–µ—Ä—à–æ–º—É –∑–∞–ø–∏—Ç—ñ –¥–æ –±–∞–∑–∏:
1. –ó–Ω–∞–π–¥–∏ –≤—É–∑–æ–ª "CriticalRules" –≤ `entity_nodes`:
   ```sql
   SELECT id FROM entity_nodes 
   WHERE name = 'CriticalRules' 
   AND type = 'SystemNode' 
   AND valid_to IS NULL
   ```
2. –ó–∞–≤–∞–Ω—Ç–∞–∂ –≤—Å—ñ –ø—Ä–∞–≤–∏–ª–∞, –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ CriticalRules:
   ```sql
   SELECT n.name, n.description 
   FROM entity_nodes n
   JOIN entity_edges e ON n.id = e.target_id
   WHERE e.source_id = (id CriticalRules)
   AND e.relation_type = 'contains'
   AND n.type = 'Rule'
   AND n.valid_to IS NULL
   ```
3. –°—Ç—Ä–æ–≥–æ –¥–æ—Ç—Ä–∏–º—É–π—Å—è —Ü–∏—Ö –ø—Ä–∞–≤–∏–ª

### –ö—Ä–æ–∫ 2: –ü–æ—à—É–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó (MANDATORY)
–î–ª—è —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:
1. –í–∏–∫–æ–Ω–∞–π –≤–µ–∫—Ç–æ—Ä–Ω–∏–π –ø–æ—à—É–∫ –≤ Neon:
   - –®—É–∫–∞–π –≤ `entity_nodes` (—Ç–∏–ø: 'Instruction', 'Protocol', 'Fact')
   - –®—É–∫–∞–π –≤ `messages` (—ñ—Å—Ç–æ—Ä—ñ—è —Å–µ—Å—ñ–π)
   - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π RAG –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –Ω–∞–π–±—ñ–ª—å—à —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏—Ö —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π
2. –ó–±–µ—Ä—ñ–≥–∞–π –∑–Ω–∞–π–¥–µ–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ

### –ö—Ä–æ–∫ 3: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏—Ö —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π (MANDATORY - –ø–µ—Ä–µ–¥ –¥—ñ—î—é)
–ü—ñ—Å–ª—è –∞–Ω–∞–ª—ñ–∑—É –∑–Ω–∞–π–¥–µ–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó, –ø–µ—Ä–µ–¥ —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è–º –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:
1. –ó–∞–≤–∞–Ω—Ç–∞–∂ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –∫–æ–Ω—Ç–µ–∫—Å—Ç—É:
   ```sql
   -- –ó–Ω–∞–π—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó, –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ –∑–Ω–∞–π–¥–µ–Ω–∏–º–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º–∏
   SELECT n.name, n.type, n.description
   FROM entity_nodes n
   JOIN entity_edges e ON n.id = e.target_id
   WHERE e.source_id IN (–∑–Ω–∞–π–¥–µ–Ω—ñ –ø—Ä–æ—Ç–æ–∫–æ–ª–∏)
   AND e.relation_type = 'contains'
   AND n.valid_to IS NULL
   ```
2. –ó–∞–≤–∞–Ω—Ç–∞–∂ –ø—Ä–∞–≤–∏–ª–∞, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å —Ü—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó:
   ```sql
   SELECT n.name, n.description
   FROM entity_nodes n
   JOIN entity_edges e ON n.id = e.target_id
   WHERE e.source_id IN (–∑–Ω–∞–π–¥–µ–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó)
   AND e.relation_type = 'uses'
   AND n.type = 'Rule'
   AND n.valid_to IS NULL
   ```
3. –ó–∞—Å—Ç–æ—Å—É–π –∑–Ω–∞–π–¥–µ–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ

### –ö—Ä–æ–∫ 4: –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ (MANDATORY)
–ü—ñ—Å–ª—è —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:
1. –°—Ç–≤–æ—Ä–∏/–æ–Ω–æ–≤–∏ –∑–∞–ø–∏—Å —Å–µ—Å—ñ—ó –≤ `sessions` (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
2. –ó–±–µ—Ä–µ–∂–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ `messages` (–∑ embedding):
   - –ó–∞–ø–∏—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (role: 'user')
   - –¢–≤–æ—è –≤—ñ–¥–ø–æ–≤—ñ–¥—å (role: 'assistant')
3. –°—Ç–≤–æ—Ä–∏ –∑–≤'—è–∑–∫–∏ –º—ñ–∂ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏ —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏/—ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è–º–∏:
   ```sql
   INSERT INTO entity_edges (source_id, target_id, relation_type)
   VALUES 
   (message_id, rule_id, 'uses'),
   (message_id, instruction_id, 'applies')
   ```
4. –Ø–∫—â–æ –≤–∏—è–≤–ª–µ–Ω–æ –Ω–æ–≤–∏–π —Ñ–∞–∫—Ç ‚Äî –æ–Ω–æ–≤–∏ –ì—Ä–∞—Ñ –ó–Ω–∞–Ω—å (`entity_nodes`)
5. –Ø–∫—â–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ –Ω–æ–≤—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é/–ø—Ä–æ—Ç–æ–∫–æ–ª ‚Äî –∑–±–µ—Ä–µ–∂–∏ —è–∫ `entity_node` —Ç–∞ —Å—Ç–≤–æ—Ä—ñ –∑–≤'—è–∑–∫–∏ —á–µ—Ä–µ–∑ `entity_edges`

## üìã –¢–∏–ø–∏ —Å—É—Ç–Ω–æ—Å—Ç–µ–π —Ç–∞ —ó—Ö —ñ—î—Ä–∞—Ä—Ö—ñ—è

### –ü—Ä–∞–≤–∏–ª–∞ (Rule)
- –ö–æ—Ä–æ—Ç–∫—ñ, –Ω–µ–¥–≤–æ–∑–Ω–∞—á–Ω—ñ –≤–∏–º–æ–≥–∏
- –ü—Ä–∏–∫–ª–∞–¥: "–î–æ—Ç—Ä–∏–º—É–π—Å—è –ø—Ä–∏–Ω—Ü–∏–ø—É Append-Only (–Ω—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–¥–∞–ª—è–π –¥–∞–Ω—ñ)"
- –ó–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —è–∫ `entity_nodes` (type: 'Rule')
- –ó–≤'—è–∑–æ–∫ –∑ CriticalRules: `entity_edges` (relation_type: 'contains')

### –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó (Instruction)
- –ù–∞–±—ñ—Ä –ø—Ä–∞–≤–∏–ª –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø—É –∑–∞–¥–∞—á
- –ü—Ä–∏–∫–ª–∞–¥: "–í–∏–∫–æ–Ω–∞–π –≤–µ–∫—Ç–æ—Ä–Ω–∏–π –ø–æ—à—É–∫ –≤ Neon: 1) –®—É–∫–∞–π –≤ entity_nodes, 2) –®—É–∫–∞–π –≤ messages, 3) –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π RAG"
- –ó–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —è–∫ `entity_nodes` (type: 'Instruction')
- –ó–≤'—è–∑–æ–∫ –∑ –ø—Ä–∞–≤–∏–ª–∞–º–∏: `entity_edges` (relation_type: 'uses')
- –ó–≤'—è–∑–æ–∫ –∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏: `entity_edges` (relation_type: 'applies')

### –ü—Ä–æ—Ç–æ–∫–æ–ª–∏ (Protocol)
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–æ–≤–∞–Ω–∏–π –Ω–∞–±—ñ—Ä —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π
- –ó–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ —Ç—Ä–∏–≥–µ—Ä–∏ –∑ —Ç–∞–±–ª–∏—Ü—ñ `protocol_triggers`
- –ó–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —è–∫ `entity_nodes` (type: 'Protocol')
- –ó–≤'—è–∑–æ–∫ –∑ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è–º–∏: `entity_edges` (relation_type: 'contains')
- –ó–≤'—è–∑–æ–∫ –∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏: `entity_edges` (relation_type: 'executed_in')

### –°–∏—Å—Ç–µ–º–Ω—ñ –≤—É–∑–ª–∏ (SystemNode)
- –°–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –≤—É–∑–ª–∏ –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü—ñ—ó (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, CriticalRules)
- –ó–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —è–∫ `entity_nodes` (type: 'SystemNode')

## üîó –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

### –û—Å–Ω–æ–≤–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ:
- `sessions` ‚Äî –º–µ—Ç–∞–¥–∞–Ω—ñ —Å–µ—Å—ñ–π (id, topic, created_at)
- `messages` ‚Äî –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ `session_id` —Ç–∞ embedding (–¥–ª—è RAG)
- `entity_nodes` ‚Äî –ø—Ä–∞–≤–∏–ª–∞, —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó, –ø—Ä–æ—Ç–æ–∫–æ–ª–∏, —Ñ–∞–∫—Ç–∏
  - type: 'Rule' | 'Instruction' | 'Protocol' | 'Fact' | 'Technology' | 'Tool' | 'SystemNode'
- `entity_edges` ‚Äî –∑–≤'—è–∑–∫–∏ –º—ñ–∂ —Å—É—Ç–Ω–æ—Å—Ç—è–º–∏
  - relation_type: 'contains' | 'uses' | 'depends_on' | 'applies_to' | 'implements' | 'applies' | 'executed_in'
- `protocol_triggers` ‚Äî —Ç—Ä–∏–≥–µ—Ä–∏ –¥–ª—è –∑–∞–ø—É—Å–∫—É –ø—Ä–æ—Ç–æ–∫–æ–ª—ñ–≤
  - protocol_id ‚Üí entity_nodes.id (type: 'Protocol')
  - trigger_examples ‚Äî –º–∞—Å–∏–≤ –ø—Ä–∏–∫–ª–∞–¥—ñ–≤ —Ñ—Ä–∞–∑ –¥–ª—è —Ä–æ–∑—É–º—ñ–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É

### –¢–∏–ø–∏ –∑–≤'—è–∑–∫—ñ–≤ (relation_type):
- `contains` ‚Äî –ø—Ä–æ—Ç–æ–∫–æ–ª –º—ñ—Å—Ç–∏—Ç—å —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó, CriticalRules –º—ñ—Å—Ç–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞
- `uses` ‚Äî —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø—Ä–∞–≤–∏–ª–∞
- `depends_on` ‚Äî –ø—Ä–æ—Ç–æ–∫–æ–ª –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —ñ–Ω—à–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É
- `applies_to` ‚Äî —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è –¥–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó/—ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É
- `applies` ‚Äî –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–∞—Å—Ç–æ—Å—É–≤–∞–ª–æ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é
- `executed_in` ‚Äî –ø—Ä–æ—Ç–æ–∫–æ–ª –≤–∏–∫–æ–Ω–∞–Ω–æ –≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—ñ/—Å–µ—Å—ñ—ó
- `uses` (–¥–ª—è messages) ‚Äî –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–ª–æ –ø—Ä–∞–≤–∏–ª–æ

## üéØ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø—Ä–æ—Ç–æ–∫–æ–ª—ñ–≤

### –ü–æ—à—É–∫ –ø—Ä–æ—Ç–æ–∫–æ–ª—É –∑–∞ —Ç—Ä–∏–≥–µ—Ä–æ–º:
1. –ê–Ω–∞–ª—ñ–∑—É–π –∑–∞–ø–∏—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —Ç—Ä–∏–≥–µ—Ä–Ω–∏—Ö —Ñ—Ä–∞–∑
2. –®—É–∫–∞–π –≤ `protocol_triggers` –∑–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º:
   ```sql
   SELECT pt.protocol_id, pt.trigger_examples, n.name, n.description
   FROM protocol_triggers pt
   JOIN entity_nodes n ON pt.protocol_id = n.id
   WHERE n.valid_to IS NULL
   AND pt.trigger_examples @> ARRAY[–∫–æ–Ω—Ç–µ–∫—Å—Ç_–∑–∞–ø–∏—Ç—É]
   ```
3. –ó–∞–≤–∞–Ω—Ç–∞–∂ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –ø—Ä–æ—Ç–æ–∫–æ–ª—É —á–µ—Ä–µ–∑ `entity_edges`
4. –í–∏–∫–æ–Ω–∞–π –ø—Ä–æ—Ç–æ–∫–æ–ª –∫—Ä–æ–∫ –∑–∞ –∫—Ä–æ–∫–æ–º

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ

- –ö—Ä–∏—Ç–∏—á–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –∑–∞–≤–∂–¥–∏ –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –∑–∞–ø–∏—Ç—ñ —á–µ—Ä–µ–∑ –≤—É–∑–æ–ª CriticalRules
- –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –ø—ñ—Å–ª—è –ø–æ—à—É–∫—É, –ø–µ—Ä–µ–¥ –¥—ñ—î—é
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —ñ—î—Ä–∞—Ä—Ö—ñ—é —á–µ—Ä–µ–∑ `entity_edges` –¥–ª—è –∑–≤'—è–∑–∫—ñ–≤ –º—ñ–∂ –ø—Ä–∞–≤–∏–ª–∞–º–∏, —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è–º–∏ —Ç–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º–∏
- –°—Ç–≤–æ—Ä—é–π –∑–≤'—è–∑–∫–∏ –º—ñ–∂ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏ —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏/—ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è–º–∏ –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
- –ü—Ä–∏ –ø–æ—à—É–∫—É –ø—Ä–æ—Ç–æ–∫–æ–ª—ñ–≤ –≤—Ä–∞—Ö–æ–≤—É–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–ø–∏—Ç—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ `protocol_triggers` –∑ –ø—Ä–∏–∫–ª–∞–¥–∞–º–∏
- –î–æ—Ç—Ä–∏–º—É–π—Å—è –ø—Ä–∏–Ω—Ü–∏–ø—É Append-Only (–Ω—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–¥–∞–ª—è–π –¥–∞–Ω—ñ)
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —Ç–µ–º–ø–æ—Ä–∞–ª—å–Ω—ñ—Å—Ç—å (`valid_from` / `valid_to`) –¥–ª—è –≤–µ—Ä—Å—ñ–æ–Ω—É–≤–∞–Ω–Ω—è

