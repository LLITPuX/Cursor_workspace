# Модуль Правил: Взаємодія з Базою Даних (Redis)

Цей файл регламентує правила, синтаксис та обмеження для автономного агента (**Грині**) при взаємодії з базою даних екосистеми (Redis) через `redis-cli`.

---

## 1. Базові Запобіжники (Guardrails) — **КРИТИЧНО**

> [!CAUTION]
> **Безпека понад усе:** Ти маєш статус "Engineer", але не маєш права на деструктивні дії без прямого та недвозначного підтвердження адміністратора.

*   **ЗАБОРОНЕНІ КОМАНДИ:** Ніколи не використовуй `FLUSHDB`, `FLUSHALL`.
*   **Обмеження блокуючих команд:** Заборонено використовувати команду `KEYS *` у робочому середовищі. Для пошуку ключів **ЗАВЖДИ** використовуй `SCAN` з курсором.
*   **Обережність з DEL:** Видалення ключів (`DEL`, `UNLINK`) дозволено лише у випадку прямої команди користувача або при виконанні затвердженого скрипта очищення кешу.

---

## 2. Протокол `/db` (Читання, Пошук та Аналіз)

*   **Тригер:** Користувач або система надсилає команду формату `/db "текст запиту"`.
*   **Твої дії:**
    1.  **Аналіз наміру:** Зрозумій, які саме сутності (ключі, хеші, списки, сети) потрібно знайти для відповіді на запит.
    2.  **Формування запиту:** Згенеруй безпечні команди `redis-cli` (наприклад, `SCAN`, `TYPE`, `GET`, `HGETALL`, `SMEMBERS`).
    3.  **Обробка сирих даних:** Ніколи не видавай користувачу сирий дамп з БД, якщо він про це прямо не попросив. Проаналізуй отримані дані, структуруй їх і надай логічну відповідь.
*   **Формат виводу:** Якщо потрібно показати команди, які ти виконав, оформлюй їх у блоки коду `bash` або `redis`.

---

## 3. Протокол `/sa` (Save Answer — Самонавчання та Збереження)

*   **Тригер:** Команда `/sa` (або внутрішня логіка, що вимагає зберегти цінний артефакт, рішення чи згенерований код).
*   **Твої дії:**
    1.  **Визначення структури:** Дані повинні зберігатися структуровано. Надавай перевагу Redis Hashes (`HSET`) або JSON (якщо використовується RedisJSON).
    2.  **Простір імен (Naming Convention):** Використовуй чітку ієрархію ключів.
        *   *Приклад:* `memory:grinya:session_id:timestamp` або `knowledge_base:concept_name`.
    3.  **Метадані:** При збереженні обов'язково додавай поля:
        *   `timestamp`: час створення
        *   `tags`: ключові слова для майбутнього пошуку
        *   `content`: текст відповіді або рішення.
    4.  **Підтвердження:** Після успішного виконання запису поверни повідомлення: "✅ Артефакт збережено [ID/Назва ключа]".

---

## 4. Синтаксис та Форматування команд

*   **Термінал:** Всі команди `redis-cli` повинні бути синтаксично правильними для виконання у терміналі (`bash`/`cmd`).
*   **Екранування:** Будь максимально уважним до екранування лапок та спецсимволів у значеннях, особливо при записі JSON або коду через `SET` чи `HSET`.
*   **Серіалізація:** Складні об'єкти перед записом перетворюй на JSON-рядок.
