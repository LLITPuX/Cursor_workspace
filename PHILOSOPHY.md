# üß† –§—ñ–ª–æ—Å–æ—Ñ—ñ—è —Å–∏—Å—Ç–µ–º–∏ –ø–∞–º'—è—Ç—ñ Cursor AI

## –û—Å–Ω–æ–≤–Ω—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∏

### 1. –ì—Ä–∞—Ñ –∑–Ω–∞–Ω—å (Knowledge Graph)
–°–∏—Å—Ç–µ–º–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –≥—Ä–∞—Ñ –∑–Ω–∞–Ω—å –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ç–∞ –∑–≤'—è–∑—É–≤–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó:
- **–í—É–∑–ª–∏ (entity_nodes)** ‚Äî –ø—Ä–∞–≤–∏–ª–∞, —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó, –ø—Ä–æ—Ç–æ–∫–æ–ª–∏, —Ñ–∞–∫—Ç–∏
- **–†–µ–±—Ä–∞ (entity_edges)** ‚Äî –∑–≤'—è–∑–∫–∏ –º—ñ–∂ –≤—É–∑–ª–∞–º–∏ –∑ —Ç–∏–ø–∞–º–∏ –≤—ñ–¥–Ω–æ—à–µ–Ω—å
- **–¢–µ–º–ø–æ—Ä–∞–ª—å–Ω—ñ—Å—Ç—å** ‚Äî –≤–µ—Ä—Å—ñ–æ–Ω—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ `valid_from`/`valid_to`

### 2. –Ü—î—Ä–∞—Ä—Ö—ñ—è –∑–Ω–∞–Ω—å
```
SystemNode (CriticalRules)
  ‚îî‚îÄ Rule (—Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∏)
      ‚îî‚îÄ Instruction (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø—Ä–∞–≤–∏–ª–∞)
          ‚îî‚îÄ Protocol (–º—ñ—Å—Ç–∏—Ç—å —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó)
```

### 3. Append-Only –ø—Ä–∏–Ω—Ü–∏–ø
–î–∞–Ω—ñ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è, —Ç—ñ–ª—å–∫–∏ –∞—Ä—Ö—ñ–≤—É—é—Ç—å—Å—è:
- –ü—Ä–∏ –∑–º—ñ–Ω—ñ —Ñ–∞–∫—Ç—É: –∑–∞–∫—Ä–∏–≤–∞—î—Ç—å—Å—è —Å—Ç–∞—Ä–∏–π (`valid_to = NOW()`), —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–æ–≤–∏–π
- –ü–æ–≤–Ω–∞ —ñ—Å—Ç–æ—Ä—ñ—è –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É —Ç–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è

### 4. RAG (Retrieval-Augmented Generation)
–í–µ–∫—Ç–æ—Ä–Ω–∏–π –ø–æ—à—É–∫ –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó:
- –ü–æ—à—É–∫ –≤ —ñ—Å—Ç–æ—Ä—ñ—ó —Å–µ—Å—ñ–π (`messages`)
- –ü–æ—à—É–∫ –≤ –≥—Ä–∞—Ñ—ñ –∑–Ω–∞–Ω—å (`entity_nodes`)
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è similarity scores –¥–ª—è —Ä–∞–Ω–∂—É–≤–∞–Ω–Ω—è

### 5. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ –ø—Ä–æ—Ç–æ–∫–æ–ª–∏
–ü—Ä–æ—Ç–æ–∫–æ–ª–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —á–µ—Ä–µ–∑ —Ç—Ä–∏–≥–µ—Ä–∏:
- –ê–Ω–∞–ª—ñ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –∑–∞–ø–∏—Ç—É
- –ü–æ—à—É–∫ –∑–±—ñ–≥—ñ–≤ –≤ `protocol_triggers`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–æ—Ç–æ–∫–æ–ª—É

## –¢–∏–ø–∏ —Å—É—Ç–Ω–æ—Å—Ç–µ–π

### –ü—Ä–∞–≤–∏–ª–∞ (Rule)
–ö–æ—Ä–æ—Ç–∫—ñ, –Ω–µ–¥–≤–æ–∑–Ω–∞—á–Ω—ñ –≤–∏–º–æ–≥–∏:
- –ü—Ä–∏–∫–ª–∞–¥: "–î–æ—Ç—Ä–∏–º—É–π—Å—è –ø—Ä–∏–Ω—Ü–∏–ø—É Append-Only"
- –ó–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ `entity_nodes` (type: 'Rule')
- –ó–≤'—è–∑–∞–Ω—ñ –∑ CriticalRules —á–µ—Ä–µ–∑ `entity_edges` (relation_type: 'contains')

### –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó (Instruction)
–ù–∞–±—ñ—Ä –ø—Ä–∞–≤–∏–ª –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø—É –∑–∞–¥–∞—á:
- –ü—Ä–∏–∫–ª–∞–¥: "–í–∏–∫–æ–Ω–∞–π –≤–µ–∫—Ç–æ—Ä–Ω–∏–π –ø–æ—à—É–∫: 1) –®—É–∫–∞–π –≤ entity_nodes, 2) –®—É–∫–∞–π –≤ messages"
- –ó–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ `entity_nodes` (type: 'Instruction')
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –ø—Ä–∞–≤–∏–ª–∞ —á–µ—Ä–µ–∑ `entity_edges` (relation_type: 'uses')

### –ü—Ä–æ—Ç–æ–∫–æ–ª–∏ (Protocol)
–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–æ–≤–∞–Ω–∏–π –Ω–∞–±—ñ—Ä —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π:
- –ó–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ —Ç—Ä–∏–≥–µ—Ä–∏ –∑ `protocol_triggers`
- –ó–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ `entity_nodes` (type: 'Protocol')
- –ú—ñ—Å—Ç—è—Ç—å —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó —á–µ—Ä–µ–∑ `entity_edges` (relation_type: 'contains')

## –¶–∏–∫–ª —Ä–æ–±–æ—Ç–∏

1. **–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–∞–≤–∏–ª** ‚Äî –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –∑–∞–ø–∏—Ç—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è CriticalRules
2. **–ü–æ—à—É–∫ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó** ‚Äî –≤–µ–∫—Ç–æ—Ä–Ω–∏–π –ø–æ—à—É–∫ –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏—Ö —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π
3. **–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π** ‚Äî –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π —Ç–∞ –ø—Ä–∞–≤–∏–ª
4. **–í–∏–∫–æ–Ω–∞–Ω–Ω—è** ‚Äî –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π –¥–ª—è —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
5. **–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è** ‚Äî –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Å–µ—Å—ñ—ó –∑ –∑–≤'—è–∑–∫–∞–º–∏ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏—Ö –ø—Ä–∞–≤–∏–ª/—ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π

## –ü–µ—Ä–µ–≤–∞–≥–∏ –ø—ñ–¥—Ö–æ–¥—É

- **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å** ‚Äî –ª–µ–≥–∫–æ –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤—ñ –ø—Ä–∞–≤–∏–ª–∞ —Ç–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó
- **–í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è** ‚Äî –ø–æ–≤–Ω–∞ —ñ—Å—Ç–æ—Ä—ñ—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø—Ä–∞–≤–∏–ª —Ç–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π
- **–ì–Ω—É—á–∫—ñ—Å—Ç—å** ‚Äî –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤–µ—Ä—Å—ñ–æ–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ –∞—Ä—Ö—ñ–≤—É–≤–∞–Ω–Ω—è
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è** ‚Äî –ø—Ä–æ—Ç–æ–∫–æ–ª–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
- **RAG** ‚Äî –≤–µ–∫—Ç–æ—Ä–Ω–∏–π –ø–æ—à—É–∫ –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó

## –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –ø—Ä–∞–≤–∏–ª
```bash
GET /api/v1/rules/critical
```

### –í–µ–∫—Ç–æ—Ä–Ω–∏–π –ø–æ—à—É–∫
```bash
POST /api/v1/rag/search-messages
{
  "query_text": "–Ø–∫ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö?",
  "limit": 10
}
```

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–≤'—è–∑–∫—ñ–≤
```bash
POST /api/v1/messages/{message_id}/link-entity?entity_id={rule_id}&relation_type=uses
```
